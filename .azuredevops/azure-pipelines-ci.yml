variables:
  system.debug: true

trigger:
- master
- develop
- release/*
- feature/*
- hotfix/*

jobs:
- job: AgentJobMain
  displayName: Agent job - Main $(imageName)
  strategy:
    maxParallel: 99
    matrix:
      linux:
        imageName: 'ubuntu-latest'
      mac:
        imageName: 'macOS-latest'
      windows:
        imageName: 'windows-latest'
  pool:
    vmImage: $(imageName)

  steps:
  - task: UsePythonVersion@0
    inputs:
      versionSpec: '3.x'
      addToPath: true
      architecture: 'x64'
    
  - bash: |
      if [ -f .pre-commit-config.yaml ]; then
        echo "##vso[task.setVariable variable=FILEEXISTS_PRECOMMIT]true"
      fi
    displayName: Check if .pre-commit-config.yaml exist
  - script: |
      az bicep install
    condition: eq(variables.imageName, 'macOS-latest')
  - script: |
      pip install pre-commit
      pre-commit --version
      pre-commit run --all-files
    condition: eq(variables.FILEEXISTS_PRECOMMIT, 'true')
    displayName: Execture pre-commit